# Analyse compl√®te du projet Math-Magie

Audit du projet apr√®s lecture exhaustive de tous les fichiers HTML, CSS et JavaScript.

---

## üêõ Bugs & Probl√®mes fonctionnels

### 1. CSS mort : [calculs_mentaux/styles/index.css](file:///c:/Users/pikat/Documents/Codage/javascript/math-magie/calculs_mentaux/styles/index.css) jamais utilis√©

Le fichier [index.css](file:///c:/Users/pikat/Documents/Codage/javascript/math-magie/calculs_mentaux/styles/index.css) (151 lignes) contient un ancien th√®me sombre (couleurs `#fff`, `#bbb`, `#ccc`, ombres noires `#151515`‚Ä¶) **qui n'est import√© par aucune page HTML**. Les pages de `calculs_mentaux/` utilisent [style/missions-liste.css](file:///c:/Users/pikat/Documents/Codage/javascript/math-magie/style/missions-liste.css).

> [!WARNING]
> Ce fichier est du **code mort** mais contient des classes identiques √† celles de [missions-liste.css](file:///c:/Users/pikat/Documents/Codage/javascript/math-magie/style/missions-liste.css) (`.carte-mission`, `.badge-difficulte`, `.btn-lancer`‚Ä¶). S'il est accidentellement import√©, il cassera le th√®me visuel.

### 2. [bk-img.js](file:///c:/Users/pikat/Documents/Codage/javascript/math-magie/style/bk-img.js) est charg√© inutilement sur l'accueil

[bk-img.js](file:///c:/Users/pikat/Documents/Codage/javascript/math-magie/style/bk-img.js) est inclus dans [index.html](file:///c:/Users/pikat/Documents/Codage/javascript/math-magie/index.html) mais :
- Il cherche `.bk-img`, `#suivant`, `#precedent` ‚Üí **aucun de ces √©l√©ments n'existe** dans le DOM
- Le script tourne dans le vide, sans crash gr√¢ce √† l'optional chaining `?.`, mais c'est un **chargement r√©seau inutile**

### 3. Le select de niveau a un th√®me incoh√©rent (fond noir `#1a1a1a`)

Dans [moteur_calcul.js:35](file:///c:/Users/pikat/Documents/Codage/javascript/math-magie/calculs_mentaux/js/moteur_calcul.js#L35) et [moteur_geometrie.js:39](file:///c:/Users/pikat/Documents/Codage/javascript/math-magie/geometrie/js/moteur_geometrie.js#L39) :
```html
background: #1a1a1a; color: white;
```
Ce fond noir pur est un **vestige d'un ancien th√®me sombre** et ne correspond absolument pas au th√®me clair/pastel actuel. L'√©l√©ment est ensuite re-styl√© par le CSS [exercice-commun.css](file:///c:/Users/pikat/Documents/Codage/javascript/math-magie/style/exercice-commun.css) (L378-390) qui impose `background-color: white !important; color: var(--primary-color) !important;`, **masquant le bug** ‚Äî mais le style inline reste incoh√©rent et il y a un flash visible pendant le chargement.

### 4. Acc√®s au `<select>` de niveau en g√©om√©trie limit√© √† 3 niveaux

Le [moteur_geometrie.js:40-43](file:///c:/Users/pikat/Documents/Codage/javascript/math-magie/geometrie/js/moteur_geometrie.js#L40-L43) ne propose que 3 options (1, 2, 3) alors que la plupart des missions g√©om√©trie ([vrai_faux.js](file:///c:/Users/pikat/Documents/Codage/javascript/math-magie/geometrie/js/vrai_faux.js), [droites.js](file:///c:/Users/pikat/Documents/Codage/javascript/math-magie/geometrie/js/droites.js), [symetrie.js](file:///c:/Users/pikat/Documents/Codage/javascript/math-magie/geometrie/js/symetrie.js), [angles.js](file:///c:/Users/pikat/Documents/Codage/javascript/math-magie/geometrie/js/angles.js)) **n'utilisent pas du tout le param√®tre `niveau`** dans [genererQuestion()](file:///c:/Users/pikat/Documents/Codage/javascript/math-magie/geometrie/js/formes.js#6-112). Le s√©lecteur donne l'illusion que le niveau change la difficult√© alors que ce n'est souvent **pas le cas**.

### 5. Pas de `nomOperation` dans certains configs g√©om√©trie

Les configs [configAngles](file:///c:/Users/pikat/Documents/Codage/javascript/math-magie/geometrie/js/angles.js) et [configSymetrie](file:///c:/Users/pikat/Documents/Codage/javascript/math-magie/geometrie/js/symetrie.js) ne d√©clarent pas `nomOperation`. Le moteur utilise alors `"geometrie-defaut"`, ce qui signifie que :
- Les **progressions de ces missions sont m√©lang√©es** dans le m√™me localStorage
- Les **troph√©es ne sont pas attribu√©s** correctement (le troph√©e attend par ex. `math-magie-geometrie-triangles` mais le `nomOperation` n'existe pas)

### 6. La page Troph√©es ne refl√®te pas les bonnes cl√©s localStorage

[trophees.html:78-86](file:///c:/Users/pikat/Documents/Codage/javascript/math-magie/trophees.html#L78-L86) utilise des IDs comme `geometrie-formes`, `geometrie-droites`, `geometrie-triangles`, `geometrie-quadrilateres`, `geometrie-patrons`. Mais les fichiers de config utilisent des `nomOperation` comme `geometrie-formes`, `geometrie-droites`‚Ä¶ **Certains ne d√©finissent pas de `nomOperation`** (voir point 5), donc les cl√©s localStorage ne correspondront jamais ‚Üí les troph√©es de ces missions resteront **toujours verrouill√©s**.

### 7. Dossier vide `geometrie/styles/`

Le r√©pertoire `geometrie/styles/` est **compl√®tement vide** ‚Äî probablement un vestige de refactoring.

---

## üé® Contrastes & Accessibilit√©

### 8. Texte `var(--text-muted)` (`#64748b`) sur fond `#F0F9FF`

Ratio estim√© : **~4.3:1**. C'est juste au-dessus du minimum **AA** (4.5:1 pour le texte normal). Avec les descriptions de sous-titre √† `1.05rem`, cela passe limite mais pourrait **poser probl√®me sur certains √©crans**. Envisager un gris plus fonc√© comme `#475569`.

### 9. Liens de navigation `var(--text-muted)` sur fond `#F8FAFC`

Les liens dans `.choix-navigation li a` utilisent `color: var(--text-muted)` (`#64748b`) sur un fond `#F8FAFC` quasi-blanc ‚Üí **ratio ~4.5:1**, bordeline pour l'accessibilit√© AA.

### 10. Le bouton orange `#FF8C00` sur blanc a un contraste texte suffisant‚Ä¶

Le texte blanc sur fond `#FF8C00` donne un ratio d'environ **3.0:1**, ce qui **√©choue au crit√®re AA** (4.5:1). C'est le cas pour `.bouton-action` (bouton "Commencer") sur la page d'accueil. Sur un public d'enfants, c'est particuli√®rement critique.

### 11. Styles inline des boutons de `formes.html` √©crasent `exercice-commun.css`

Dans [formes.html:15-17](file:///c:/Users/pikat/Documents/Codage/javascript/math-magie/geometrie/missions/formes.html#L15-L17), les styles inline d√©finissent `.bouton-option` avec :
- `background: var(--secondary-color)` et `box-shadow: 0 4px 0px #2e6630` (vert for√™t) ‚Üí **incoh√©rent visuellement**, le vert ne s'accorde pas avec le bleu calme
- Les classes et styles se battent avec `exercice-commun.css`, cr√©ant des inconsistances

---

## üß© Logique d'interface

### 12. Le calcul mental n'a pas de limite de questions

Contrairement √† `MoteurGeometrie` qui s'arr√™te apr√®s 10 questions (`limiteQuestions`), `MoteurCalcul` tourne **ind√©finiment**. Cela peut fatiguer les enfants sans objectif de fin. Envisager d'ajouter une fin de session avec un r√©sum√©.

### 13. Pas de bouton "Retour" ni de navigation claire dans les exercices

Quand un enfant est dans un exercice (ex: `additions.html`), le seul moyen de revenir est le **header**. Il n'y a pas de bouton "‚Üê Retour aux missions" visible et imm√©diat en bas ou en haut de la zone de jeu.

### 14. Vouvoiement vs Tutoiement incoh√©rent

- Les pages d'exercices calculs utilisent **"Votre taux de r√©ussite"** (vouvoiement)
- Le reste du site tutoie l'enfant : **"Deviens un champion"**, **"Ton score"**, **"Tu passes au niveau sup√©rieur"**
- La page troph√©es : **"badges que tu as gagn√©s"**

‚Üí **Incoh√©rence de registre** √† harmoniser (tutoiement partout pour un public enfant).

### 15. Le "Niveau" affich√© sur les cartes de mission est **statique et fixe**

Les badges sur les cartes (`NIVEAU 1`, `NIVEAU 2`‚Ä¶) sont cod√©s en dur en HTML. Ils ne refl√®tent **pas le niveau actuel sauvegard√©** du joueur. On pourrait dynamiser ces badges pour montrer le niveau atteint.

### 16. Troph√©e d√©bloqu√© si `niveau > 1` seulement

Dans [trophees.html:96](file:///c:/Users/pikat/Documents/Codage/javascript/math-magie/trophees.html#L96), un troph√©e est "d√©bloqu√©" d√®s que le joueur a d√©pass√© le niveau 1. C'est un **crit√®re tr√®s bas** ‚Äî un seul passage au niveau 2 suffit. Pour un syst√®me de troph√©es motivant, envisager des paliers plus √©lev√©s ou des badges par niveau (bronze, argent, or).

### 17. L'accueil ne donne aucun feedback sur la progression globale

Un enfant qui revient sur l'accueil ne voit **aucune indication** de l√† o√π il en est. Pas de progression visible, pas de score r√©capitulatif, pas d'indicateur "3/9 missions compl√©t√©es" par exemple.

---

## üèóÔ∏è Architecture & Qualit√© du code

### 18. Duplication du code de la mascotte SVG

La mascotte SVG (flamme bleue) est dupliqu√©e **mot pour mot** entre [moteur_calcul.js:62-69](file:///c:/Users/pikat/Documents/Codage/javascript/math-magie/calculs_mentaux/js/moteur_calcul.js#L62-L69) et [moteur_geometrie.js:81-88](file:///c:/Users/pikat/Documents/Codage/javascript/math-magie/geometrie/js/moteur_geometrie.js#L81-L88). Si la mascotte change, il faudra modifier deux fichiers.

### 19. Styles inline dans `header.js`

Le composant header [injecte des styles inline](file:///c:/Users/pikat/Documents/Codage/javascript/math-magie/js/composants/header.js#L18-L21) `style="min-height: 44px; display: flex; align-items: center;"` sur chaque lien de navigation, au lieu de les mettre dans le CSS. Cela rend la maintenance plus difficile.

### 20. Ordre de chargement CSS probl√©matique dans les exercices

Dans [additions.html:11-12](file:///c:/Users/pikat/Documents/Codage/javascript/math-magie/calculs_mentaux/additions/additions.html#L11-L12) :
```html
<link rel="stylesheet" href="../../style/exercice-commun.css" />
<link rel="stylesheet" href="../../style/commun.css" />
```
`commun.css` est charg√© **apr√®s** `exercice-commun.css`, ce qui fait que le reset `*, ::before, ::after` de `commun.css` est appliqu√© correctement. Mais `exercice-commun.css` a **aussi un reset `*`** (L2-6) qui entre en conflit. Cet ordre invers√© pourrait provoquer des **conflits de cascade** impr√©vus.

### 21. Image avec caract√®re accentu√© `g√©om√©trie.png`

Le fichier [images/g√©om√©trie.png](file:///c:/Users/pikat/Documents/Codage/javascript/math-magie/images/g√©om√©trie.png) contient un caract√®re sp√©cial (`√©`) dans son nom. Cela peut poser des probl√®mes :
- Sur certains serveurs web
- Avec certains syst√®mes de fichiers
- Dans les URLs si l'encoding n'est pas correctement g√©r√©

### 22. Les `alt` de `calculs_mentaux/index.html` sont vides

Les images des cartes de mission dans [calculs_mentaux/index.html:25,38,51,64](file:///c:/Users/pikat/Documents/Codage/javascript/math-magie/calculs_mentaux/index.html#L25) ont `alt=""`. En termes d'accessibilit√©, il serait mieux de fournir un texte alternatif descriptif comme c'est le cas sur la page d'accueil principale.

---

## üìã R√©sum√© des priorit√©s

| Priorit√© | # | Description |
|----------|---|-------------|
| üî¥ Haute | 5, 6 | Troph√©es cass√©s ‚Äî `nomOperation` manquant = progression perdue |
| üî¥ Haute | 10 | Contraste bouton orange/blanc insuffisant (public enfant) |
| üü† Moyenne | 3 | Select #1a1a1a (fond noir) vestige du th√®me sombre |
| üü† Moyenne | 4 | S√©lecteur de niveau sans effet r√©el en g√©om√©trie |
| üü† Moyenne | 14 | Incoh√©rence vouvoiement/tutoiement |
| üü° Basse | 1, 2, 7 | Code mort / fichiers inutiles |
| üü° Basse | 11, 20 | Conflits CSS / ordre de cascade |
| üí° Id√©e | 12, 13, 15-17 | Am√©liorations UX (fin de session, retour, progression) |
